<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Anatomical Test</title>
    <style>
        body {
            margin: 0;
            font-family: monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
        }
        .preview {
            width: 400px;
            height: 300px;
            background: #333;
            margin: 20px 0;
            border: 2px solid #555;
        }
        .log {
            white-space: pre-wrap;
            font-size: 12px;
            background: #111;
            padding: 10px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
        }
        button {
            background: #4CAF50;
            border: none;
            color: white;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>ðŸ§¬ Simple Anatomical Test</h1>
    
    <button onclick="testLandmarks()">Test Landmarks</button>
    <button onclick="testBasicMesh()">Test Basic Mesh</button>
    <button onclick="testOldSystem()">Test Old System</button>

    <div class="preview" id="preview"></div>
    <div class="log" id="log"></div>

    <!-- Three.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- System components -->
    <script src="../js/core/AnatomicalLandmarks.js"></script>
    <script src="../js/core/AnatomicalMeshGenerator.js"></script>
    <script src="../js/core/MeshTemplateSystem.js"></script>

    <script>
        const log = document.getElementById('log');
        
        function logMessage(message) {
            const timestamp = new Date().toLocaleTimeString();
            log.innerHTML += `[${timestamp}] ${message}\n`;
            log.scrollTop = log.scrollHeight;
            console.log(message);
        }

        function testLandmarks() {
            try {
                logMessage('ðŸŽ¯ Testing anatomical landmarks...');
                
                if (typeof window.AnatomicalLandmarks === 'undefined') {
                    logMessage('âŒ AnatomicalLandmarks class not found');
                    return;
                }
                
                const landmarkSystem = new window.AnatomicalLandmarks();
                logMessage('âœ… Landmark system created');
                
                const specs = {
                    gender: 'non-binary',
                    ageGroup: 'young',
                    ethnicity: 'european',
                    body: { height: 1.75 }
                };
                
                const landmarks = landmarkSystem.generateLandmarks(specs);
                logMessage(`âœ… Generated ${Object.keys(landmarks).length} landmarks`);
                
                // Show key landmarks
                const keyLandmarks = ['vertex', 'nasion', 'stomion', 'pogonion'];
                keyLandmarks.forEach(name => {
                    if (landmarks[name]) {
                        const lm = landmarks[name];
                        logMessage(`${name}: (${lm.x.toFixed(3)}, ${lm.y.toFixed(3)}, ${lm.z.toFixed(3)})`);
                    }
                });
                
                const validation = landmarkSystem.validateProportions(landmarks);
                validation.forEach(result => {
                    logMessage(`${result.test}: ${result.upper}, ${result.middle}, ${result.lower}`);
                });
                
            } catch (error) {
                logMessage(`âŒ Landmark test failed: ${error.message}`);
                logMessage(`Stack: ${error.stack}`);
            }
        }

        function testBasicMesh() {
            try {
                logMessage('ðŸ—ï¸ Testing basic mesh generation...');
                
                if (typeof window.AnatomicalMeshGenerator === 'undefined') {
                    logMessage('âŒ AnatomicalMeshGenerator class not found');
                    return;
                }
                
                const generator = new window.AnatomicalMeshGenerator();
                logMessage('âœ… Mesh generator created');
                
                // Test basic mesh creation without complex generation
                const baseMesh = generator.createBaseMeshFromTopology();
                logMessage('âœ… Base mesh created');
                
                if (baseMesh && baseMesh.attributes && baseMesh.attributes.position) {
                    const vertexCount = baseMesh.attributes.position.count;
                    logMessage(`âœ… Mesh has ${vertexCount} vertices`);
                    
                    // Show the mesh
                    showMesh(baseMesh, 'âœ… Basic Anatomical Mesh');
                } else {
                    logMessage('âŒ Invalid mesh generated');
                }
                
            } catch (error) {
                logMessage(`âŒ Mesh test failed: ${error.message}`);
                logMessage(`Stack: ${error.stack}`);
            }
        }

        async function testOldSystem() {
            try {
                logMessage('âš ï¸ Testing old primitive system...');
                
                if (typeof window.MeshTemplateSystem === 'undefined') {
                    logMessage('âŒ MeshTemplateSystem class not found');
                    return;
                }
                
                const meshSystem = new window.MeshTemplateSystem();
                await meshSystem.initialize();
                logMessage('âœ… Old system initialized');
                
                const characterSpecs = {
                    gender: 'non-binary',
                    ageGroup: 'young',
                    ethnicity: 'european'
                };
                
                const geometry = await meshSystem.generateCharacterMesh(characterSpecs);
                
                if (geometry && geometry.attributes && geometry.attributes.position) {
                    const vertexCount = geometry.attributes.position.count;
                    logMessage(`âœ… Old mesh generated: ${vertexCount} vertices`);
                    
                    showMesh(geometry, 'âš ï¸ Old Primitive Mesh');
                } else {
                    logMessage('âŒ Invalid old mesh generated');
                }
                
            } catch (error) {
                logMessage(`âŒ Old system test failed: ${error.message}`);
                logMessage(`Stack: ${error.stack}`);
            }
        }

        function showMesh(geometry, title) {
            const preview = document.getElementById('preview');
            preview.innerHTML = '';
            
            const canvas = document.createElement('canvas');
            canvas.width = 400;
            canvas.height = 300;
            
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, 400 / 300, 0.1, 1000);
            camera.position.set(2, 1.6, 3);
            camera.lookAt(0, 1, 0);
            
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 10, 5);
            scene.add(directionalLight);
            
            const material = new THREE.MeshLambertMaterial({
                color: 0x4CAF50,
                wireframe: false
            });
            
            const mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);
            
            const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(400, 300);
            renderer.setClearColor(0x333333);
            renderer.render(scene, camera);
            
            preview.appendChild(canvas);
            
            // Add title
            const titleDiv = document.createElement('div');
            titleDiv.textContent = title;
            titleDiv.style.color = '#4f4';
            titleDiv.style.textAlign = 'center';
            titleDiv.style.marginTop = '10px';
            preview.appendChild(titleDiv);
            
            // Cleanup
            material.dispose();
            renderer.dispose();
            
            logMessage(`ðŸ“º Displayed: ${title}`);
        }

        // Log ready state
        window.addEventListener('load', () => {
            logMessage('ðŸš€ Simple anatomical test ready');
            logMessage('Click buttons to test individual components');
        });
    </script>
</body>
</html>